<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="../bower_components/mocha/mocha.css" />
</head>
<body>
<div id="mocha"></div>
<script src="../bower_components/mocha/mocha.js"></script>
<script src="../bower_components/expect/index.js"></script>
<script src="../bower_components/sinon/lib/sinon.js"></script>
<script src="../bower_components/d3/d3.min.js"></script>
<script src="../lib/dagre.js"></script>
<script src="../egrid-core.js"></script>
<script>
mocha.ui('bdd');
mocha.reporter('html');

describe('EgmGraph', function() {
  describe('addConstruct', function() {
    it('should add vertex', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      expect(graph.numVertices()).to.be(1);
      expect(graph.numEdges()).to.be(0);
      expect(graph.get(u).text).to.be('original construct');
    });
  });

  describe('removeConstruct', function() {
    it('should remove vertex', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.removeConstruct(u);
      expect(graph.numVertices()).to.be(0);
      expect(graph.numEdges()).to.be(0);
    });

    it('should remove connected edge', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.ladderUp(u, {
        text: 'upper construct'
      });
      egmGraph.ladderDown(u, {
        text: 'lower construct'
      });
      egmGraph.removeConstruct(u);
      expect(graph.numVertices()).to.be(2);
      expect(graph.numEdges()).to.be(0);
    });
  });

  describe('updateConstruct', function() {
    it('should change property of construct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.updateConstruct(u, 'text', 'updated');
      expect(graph.get(u).text).to.be('updated');
    });
  });

  describe('ladderUp', function() {
    it('should add vertex and edge', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      var v = egmGraph.ladderUp(u, {
        text: 'upper construct'
      });
      expect(graph.numVertices()).to.be(2);
      expect(graph.numEdges()).to.be(1);
      expect(graph.get(v).text).to.be('upper construct');
    });
  });

  describe('ladderDown', function() {
    it('should add vertex and edge', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      var v = egmGraph.ladderDown(u, {
        text: 'lower construct'
      });
      expect(graph.numVertices()).to.be(2);
      expect(graph.numEdges()).to.be(1);
      expect(graph.get(v).text).to.be('lower construct');
    });
  });

  describe('undo', function() {
    it('should revert addConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.undo();
      expect(graph.numVertices()).to.be(0);
      expect(graph.numEdges()).to.be(0);
    });

    it('should revert removeConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.removeConstruct(u);
      egmGraph.undo();
      expect(graph.numVertices()).to.be(1);
      expect(graph.numEdges()).to.be(0);
    });

    it('should revert updateConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.updateConstruct(u, 'text', 'updated');
      egmGraph.undo();
      expect(graph.get(u).text).to.be('original construct');
    });

    it('should revert ladderUp', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.ladderUp(u, {
        text: 'upper construct'
      });
      egmGraph.undo();
      expect(graph.numVertices()).to.be(1);
      expect(graph.numEdges()).to.be(0);
    });

    it('should revert ladderDown', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.ladderUp(u, {
        text: 'lower construct'
      });
      egmGraph.undo();
      expect(graph.numVertices()).to.be(1);
      expect(graph.numEdges()).to.be(0);
    });
  });

  describe('redo', function() {
    it('should re-execute addConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.undo();
      egmGraph.redo();
      expect(graph.numVertices()).to.be(1);
      expect(graph.numEdges()).to.be(0);
    });

    it('should re-execute removeConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.removeConstruct(u);
      egmGraph.undo();
      egmGraph.redo();
      expect(graph.numVertices()).to.be(0);
      expect(graph.numEdges()).to.be(0);
    });

    it('should re-execute updateConstruct', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.updateConstruct(u, 'text', 'updated');
      egmGraph.undo();
      egmGraph.redo();
      expect(graph.get(u).text).to.be('updated');
    });

    it('should re-execute ladderUp', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.ladderUp(u, {
        text: 'upper construct'
      });
      egmGraph.undo();
      egmGraph.redo();
      expect(graph.numVertices()).to.be(2);
      expect(graph.numEdges()).to.be(1);
    });

    it('should re-execute ladderDown', function() {
      var graph = egrid.core.graph.adjacencyList();
      var egmGraph = egrid.core.egmGraph(graph);
      var u = egmGraph.addConstruct({
        text: 'original construct'
      });
      egmGraph.ladderUp(u, {
        text: 'lower construct'
      });
      egmGraph.undo();
      egmGraph.redo();
      expect(graph.numVertices()).to.be(2);
      expect(graph.numEdges()).to.be(1);
    });
  });
});

if (window.mochaPhantomJS) {
  mochaPhantomJS.run();
} else {
  mocha.run();
}
</script>
</body>
</html>
